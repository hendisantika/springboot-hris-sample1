-- HRIS Database Schema
-- Human Resource Information System
-- Created: 2025-10-08

-- Drop existing sequences if they exist
DROP SEQUENCE IF EXISTS DEPARTMENTS_SEQ;
DROP SEQUENCE IF EXISTS EMPLOYEES_SEQ;
DROP SEQUENCE IF EXISTS LOCATIONS_SEQ;

-- Create sequences
CREATE SEQUENCE DEPARTMENTS_SEQ START WITH 1 INCREMENT BY 5;
CREATE SEQUENCE EMPLOYEES_SEQ START WITH 1 INCREMENT BY 5;
CREATE SEQUENCE LOCATIONS_SEQ START WITH 1 INCREMENT BY 5;

-- =====================================================
-- REGIONS Table
-- =====================================================
CREATE TABLE IF NOT EXISTS REGIONS (
    REGION_ID INTEGER NOT NULL,
    REGION_NAME VARCHAR(255),
    PRIMARY KEY (REGION_ID)
);

-- =====================================================
-- COUNTRIES Table
-- =====================================================
CREATE TABLE IF NOT EXISTS COUNTRIES (
    COUNTRY_ID VARCHAR(255) NOT NULL,
    REGION_ID BIGINT,
    COUNTRY_NAME VARCHAR(255),
    PRIMARY KEY (COUNTRY_ID)
);

-- =====================================================
-- LOCATIONS Table
-- =====================================================
CREATE TABLE IF NOT EXISTS LOCATION (
    LOCATION_ID BIGINT NOT NULL,
    STREET_ADDRESS VARCHAR(255),
    POSTAL_CODE VARCHAR(255),
    CITY VARCHAR(255),
    STATE_PROVINCE VARCHAR(255),
    COUNTRY_ID VARCHAR(255),
    PRIMARY KEY (LOCATION_ID)
);

-- =====================================================
-- JOBS Table
-- =====================================================
CREATE TABLE IF NOT EXISTS JOBS (
    JOB_ID VARCHAR(255) NOT NULL,
    JOB_TITLE VARCHAR(255),
    MIN_SALARY DECIMAL(38,2),
    MAX_SALARY DECIMAL(38,2),
    PRIMARY KEY (JOB_ID)
);

-- =====================================================
-- DEPARTMENTS Table
-- =====================================================
CREATE TABLE IF NOT EXISTS DEPARTMENT (
    DEPARTMENT_ID BIGINT NOT NULL,
    DEPARTMENT_NAME VARCHAR(255),
    LOCATION_ID BIGINT,
    MANAGER_ID BIGINT UNIQUE,
    PRIMARY KEY (DEPARTMENT_ID)
);

-- =====================================================
-- EMPLOYEES Table
-- =====================================================
CREATE TABLE IF NOT EXISTS EMPLOYEE (
    EMPLOYEE_ID BIGINT NOT NULL,
    FIRST_NAME VARCHAR(255),
    LAST_NAME VARCHAR(255),
    EMAIL VARCHAR(255),
    PHONE_NUMBER VARCHAR(255),
    HIRE_DATE TIMESTAMP(6),
    SALARY DECIMAL(38,2),
    COMMISSION_PCT DECIMAL(38,2),
    JOB_ID VARCHAR(255),
    MANAGER_ID BIGINT,
    DEPARTMENT_ID BIGINT,
    PRIMARY KEY (EMPLOYEE_ID)
);

-- =====================================================
-- DEPARTMENT_DEPT_EMPLOYEES Join Table
-- =====================================================
CREATE TABLE IF NOT EXISTS DEPARTMENT_DEPT_EMPLOYEES (
    DEPARTMENT_DEPARTMENT_ID BIGINT NOT NULL,
    DEPT_EMPLOYEES_EMPLOYEE_ID BIGINT NOT NULL UNIQUE
);

-- =====================================================
-- HR_USERS Table (Authentication)
-- =====================================================
CREATE TABLE IF NOT EXISTS HR_USERS (
    USER_ID BIGINT GENERATED BY DEFAULT AS IDENTITY,
    USERNAME VARCHAR(50) NOT NULL UNIQUE,
    PASSWORD VARCHAR(255) NOT NULL,
    EMAIL VARCHAR(100),
    FULL_NAME VARCHAR(100),
    ROLE VARCHAR(20),
    ACTIVE BOOLEAN,
    PRIMARY KEY (USER_ID)
);

-- =====================================================
-- Foreign Key Constraints
-- =====================================================

-- Department foreign keys
ALTER TABLE DEPARTMENT
    ADD CONSTRAINT IF NOT EXISTS FK_DEPT_MANAGER
    FOREIGN KEY (MANAGER_ID)
    REFERENCES EMPLOYEE(EMPLOYEE_ID);

-- Employee foreign keys
ALTER TABLE EMPLOYEE
    ADD CONSTRAINT IF NOT EXISTS FK_EMP_DEPARTMENT
    FOREIGN KEY (DEPARTMENT_ID)
    REFERENCES DEPARTMENT(DEPARTMENT_ID);

ALTER TABLE EMPLOYEE
    ADD CONSTRAINT IF NOT EXISTS FK_EMP_JOB
    FOREIGN KEY (JOB_ID)
    REFERENCES JOBS(JOB_ID);

ALTER TABLE EMPLOYEE
    ADD CONSTRAINT IF NOT EXISTS FK_EMP_MANAGER
    FOREIGN KEY (MANAGER_ID)
    REFERENCES EMPLOYEE(EMPLOYEE_ID);

-- Department employees join table foreign keys
ALTER TABLE DEPARTMENT_DEPT_EMPLOYEES
    ADD CONSTRAINT IF NOT EXISTS FK_DEPT_EMP_EMPLOYEE
    FOREIGN KEY (DEPT_EMPLOYEES_EMPLOYEE_ID)
    REFERENCES EMPLOYEE(EMPLOYEE_ID);

ALTER TABLE DEPARTMENT_DEPT_EMPLOYEES
    ADD CONSTRAINT IF NOT EXISTS FK_DEPT_EMP_DEPARTMENT
    FOREIGN KEY (DEPARTMENT_DEPARTMENT_ID)
    REFERENCES DEPARTMENT(DEPARTMENT_ID);

-- =====================================================
-- Indexes for Performance
-- =====================================================
CREATE INDEX IF NOT EXISTS IDX_EMP_DEPARTMENT ON EMPLOYEE(DEPARTMENT_ID);
CREATE INDEX IF NOT EXISTS IDX_EMP_JOB ON EMPLOYEE(JOB_ID);
CREATE INDEX IF NOT EXISTS IDX_EMP_MANAGER ON EMPLOYEE(MANAGER_ID);
CREATE INDEX IF NOT EXISTS IDX_DEPT_LOCATION ON DEPARTMENT(LOCATION_ID);
CREATE INDEX IF NOT EXISTS IDX_LOCATION_COUNTRY ON LOCATION(COUNTRY_ID);
CREATE INDEX IF NOT EXISTS IDX_COUNTRY_REGION ON COUNTRIES(REGION_ID);
